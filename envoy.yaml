admin:
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 9901
  access_log_path: '/tmp/admin_access.log'
static_resources:
  listeners:
    name: listener_redis
    address:
      socket_address:
        address: 0.0.0.0
        port_value: 6379
    filter_chains:
      filters:
        - name: redis
          typed_config:
            "@type": type.googleapis.com/envoy.extensions.filters.network.redis_proxy.v3.RedisProxy
            stat_prefix: redis_stats
            prefix_routes:
              catch_all_route:
                cluster: cluster_redis
            settings:
              op_timeout: 60s
              enable_redirection: true
            adaptive_concurrency:
              gradient_controller_config:
                sample_aggregate_percentile:
                  value: 90
                concurrency_limit_params:
                  concurrency_update_interval: 0.1s
                min_rtt_calc_params:
                  jitter:
                    value: 10
                  interval: 60s
                  request_count: 50
              enabled:
                default_value: true
                runtime_key: "adaptive_concurrency.enabled"
            faults:
              - fault_type: DELAY
                fault_enabled:
                  default_value:
                    numerator: 20
                    denominator: HUNDRED
                  runtime_key: "bogus_key"
                delay: 2s
              - fault_type: DELAY
                fault_enabled:
                  default_value:
                    numerator: 40
                    denominator: HUNDRED
                  runtime_key: "key"
                delay: 6s
        - name: envoy.filters.network.echo
          typed_config:
  clusters:
    - name: cluster_redis
      lb_policy: CLUSTER_PROVIDED
      load_assignment:
        cluster_name: cluster_redis
        endpoints:
        - lb_endpoints:
          - endpoint:
              address:
                socket_address:
                  address: redis-cluster
                  port_value: 7000
      connect_timeout: 5s
      cluster_type:
        name: envoy.clusters.redis
        typed_config:
          "@type": type.googleapis.com/google.protobuf.Struct
          value:
            cluster_refresh_rate: 20s
            cluster_refresh_timeout: 4s
            redirect_refresh_interval: 0s
            redirect_refresh_threshold: 1
      outlier_detection:
        consecutive_local_origin_failure: 2
        base_ejection_time: 60s
        split_external_local_origin_errors: true
        max_ejection_percent: 100
        max_ejection_time: 60s
        interval: 1s
cluster_manager:
  outlier_detection:
    event_log_path: /dev/stdout